<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>네이버 광고 스크린샷 갤러리</title>
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 1rem; background: #fafafa; color: #333; }
    h1 { margin-bottom: 1rem; }
    details { margin-bottom: 0.5rem; }
    summary { cursor: pointer; font-weight: bold; }
    .section { margin-left: 1rem; }
    .image-grid { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-left: 2rem; }
    .image-grid img { max-width: 200px; border: 1px solid #ddd; border-radius: 4px; }
    .caption { font-size: 0.8rem; color: #555; text-align: center; }
  </style>

  <!-- Firebase JS SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <script>
    // 사용자 제공 Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyDyT7U-wldhe_XB73_Fx2BbD0EhejrG8JA",
      authDomain: "searcap.firebaseapp.com",
      projectId: "searcap",
      storageBucket: "searcap.firebasestorage.app",
      messagingSenderId: "290217487279",
      appId: "1:290217487279:web:95d4057be54210ab26dd5a",
      measurementId: "G-XCWHH8EBTT"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();
  </script>
</head>
<body>
  <h1>네이버 광고 스크린샷 갤러리</h1>
  <div id="gallery">로딩 중...</div>

  <script>
    const sectionLabels = {
      'powerlink-pc': 'PC 파워링크',
      'pricecompare-pc': 'PC 가격비교',
      'powerlink-mobile': '모바일 파워링크',
      'pricecompare-mobile': '모바일 가격비교',
      'fullpage': '전체 페이지'
    };

    async function loadGallery() {
      const snapshot = await db.collection('screenshots').orderBy('timestamp', 'desc').get();
      const data = {};
      snapshot.forEach(doc => {
        const { keyword, viewport, section, filePath, timestamp } = doc.data();
        data[keyword] = data[keyword] || {};
        data[keyword][viewport] = data[keyword][viewport] || {};
        data[keyword][viewport][section] = data[keyword][viewport][section] || [];
        data[keyword][viewport][section].push({ filePath, timestamp: timestamp.toDate() });
      });

      const gallery = document.getElementById('gallery');
      gallery.textContent = '';

      Object.keys(data).forEach(kw => {
        const kwDetails = document.createElement('details');
        kwDetails.open = true;
        kwDetails.innerHTML = `<summary>키워드: ${kw}</summary>`;

        Object.keys(data[kw]).forEach(vp => {
          const vpDetails = document.createElement('details');
          vpDetails.className = 'section';
          vpDetails.open = true;
          vpDetails.innerHTML = `<summary>${vp === 'pc' ? 'PC 버전' : '모바일 버전'}</summary>`;

          Object.keys(data[kw][vp]).forEach(sec => {
            const secDetails = document.createElement('details');
            secDetails.className = 'section';
            secDetails.open = false;
            const label = sectionLabels[sec] || sec;
            secDetails.innerHTML = `<summary>${label}</summary>`;

            const grid = document.createElement('div');
            grid.className = 'image-grid';

            data[kw][vp][sec].forEach(item => {
              const wrapper = document.createElement('div');
              const img = document.createElement('img');
              storage.ref(item.filePath)
                .getDownloadURL()
                .then(url => { img.src = url; })
                .catch(console.error);

              const cap = document.createElement('div');
              cap.className = 'caption';
              cap.textContent = item.timestamp.toLocaleString();

              wrapper.appendChild(img);
              wrapper.appendChild(cap);
              grid.appendChild(wrapper);
            });

            secDetails.appendChild(grid);
            vpDetails.appendChild(secDetails);
          });

          kwDetails.appendChild(vpDetails);
        });

        gallery.appendChild(kwDetails);
      });
    }

    window.addEventListener('DOMContentLoaded', loadGallery);
  </script>
</body>
</html>```
