<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>네이버 광고 스크린샷 갤러리</title>
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 1rem; background: #fafafa; color: #333; }
    h1 { margin-bottom: 1rem; }
    details { margin-bottom: 0.5rem; }
    summary { cursor: pointer; font-weight: bold; }
    .section { margin-left: 1.5rem; }
    .images { margin-left: 3rem; display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .images img { max-width: 200px; border: 1px solid #ccc; border-radius: 4px; }
    .caption { font-size: 0.8rem; color: #666; text-align: center; }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyDyT7U-wldhe_XB73_Fx2BbD0EhejrG8JA",
      authDomain: "searcap.firebaseapp.com",
      projectId: "searcap",
      storageBucket: "searcap.firebasestorage.app",
      messagingSenderId: "290217487279",
      appId: "1:290217487279:web:95d4057be54210ab26dd5a",
      measurementId: "G-XCWHH8EBTT"
    };
    // Firebase 초기화
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>
<body>
  <h1>네이버 광고 스크린샷 갤러리</h1>
  <div id="gallery">로딩 중...</div>

  <script>
    async function loadGallery() {
      const gallery = document.getElementById('gallery');
      gallery.textContent = '';
      const snapshot = await db.collection('screenshots').orderBy('timestamp', 'desc').get();
      const data = {};
      snapshot.forEach(doc => {
        const { keyword, viewport, section, timestamp, url } = doc.data();
        data[keyword] = data[keyword] || {};
        data[keyword][viewport] = data[keyword][viewport] || {};
        data[keyword][viewport][section] = data[keyword][viewport][section] || [];
        data[keyword][viewport][section].push({ url, timestamp: timestamp.toDate() });
      });

      for (const kw in data) {
        const kDet = document.createElement('details'); kDet.open = true;
        const kSum = document.createElement('summary'); kSum.textContent = kw;
        kDet.appendChild(kSum);
        for (const vp in data[kw]) {
          const vDet = document.createElement('details'); vDet.className = 'section'; vDet.open = true;
          const vSum = document.createElement('summary'); vSum.textContent = vp.toUpperCase();
          vDet.appendChild(vSum);
          for (const sec in data[kw][vp]) {
            const sDet = document.createElement('details'); sDet.className = 'section';
            const sSum = document.createElement('summary'); sSum.textContent = sec;
            sDet.appendChild(sSum);
            const imgDiv = document.createElement('div'); imgDiv.className = 'images';
            data[kw][vp][sec].forEach(item => {
              const box = document.createElement('div');
              const img = document.createElement('img'); img.src = item.url;
              const cap = document.createElement('div'); cap.className = 'caption';
              cap.textContent = item.timestamp.toLocaleString();
              box.appendChild(img); box.appendChild(cap);
              imgDiv.appendChild(box);
            });
            sDet.appendChild(imgDiv);
            vDet.appendChild(sDet);
          }
          kDet.appendChild(vDet);
        }
        gallery.appendChild(kDet);
      }
    }
    loadGallery();
  </script>
</body>
</html>
